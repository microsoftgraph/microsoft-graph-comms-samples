<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Interactive Voice Response (IVR) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Interactive Voice Response (IVR) ">
    <meta name="generator" content="docfx 2.39.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="interactive-voice-response-ivr">Interactive Voice Response (IVR)</h1>

<p>Graph Calling SDK and Core SDK can be used to make and manage IVR calls. Core SDK does not store any state for calls where as the Calling SDK provides a wrapper over Core SDK which manages the state of different resources for the bot. (See <a href="StateManagement.html">State Management</a>)</p>
<h2 id="features">Features</h2>
<ul>
<li>Answer incoming calls</li>
<li>Subscribe to tones</li>
<li>Transfer call</li>
<li>Play and stop media</li>
<li>Record</li>
<li>Recognize*</li>
</ul>
<h2 id="calling-sdk-snippets">Calling SDK Snippets</h2>
<h3 id="answering-incoming-call-with-local-media">Answering incoming call with local media</h3>
<p>First, subscibe to incoming calls.</p>
<pre><code>this.Client.Calls().OnIncoming += this.CallsOnIncoming;
</code></pre><p>When incoming call comes, the bot needs to answer with a session.</p>
<pre><code>private void CallsOnIncoming(ICallCollection sender, CollectionEventArgs&lt;ICall&gt; collectionEventArgs)
{
    var mediaSession = this.Client.CreateMediaSession(
        new AudioSocketSettings
        {
            StreamDirections = StreamDirection.Recvonly,
            SupportedAudioFormat = AudioFormat.Pcm16K
        },
        new VideoSocketSettings
        {
            StreamDirections = StreamDirection.Sendrecv,
            ReceiveColorFormat = VideoColorFormat.NV12,
            SupportedSendVideoFormats = new List&lt;VideoFormat&gt;
            {                
                VideoFormat.NV12_720x1280_30Fps,
                VideoFormat.NV12_1280x720_30Fps
            }
        });
    Task.Run(async () =&gt;
    {
        await collectionEventArgs
            .AddedResources
            .FirstOrDefault()
            .AnswerAsync(
                *BotCallbackURI*, 
                new List&lt;Modality&gt; { Modality.Audio },
                mediaSession)
            .ConfigureAwait(false);
    });
}
</code></pre><h2 id="answer-incoming-call-with-remote-media">Answer incoming call with remote media</h2>
<p>First subscibe to incoming calls.</p>
<pre><code>this.Client.Calls().OnIncoming += this.CallsOnIncoming;
</code></pre><p>When incoming call comes, the bot will answer with a <code>ServiceHostedMediaConfig</code>.</p>
<pre><code>private void CallsOnIncoming(ICallCollection sender, CollectionEventArgs&lt;ICall&gt; collectionEventArgs)
{
    var mediaConfig = new ServiceHostedMediaConfig();
    Task.Run(async () =&gt;
    {
        await collectionEventArgs
            .AddedResources
            .FirstOrDefault()
            .AnswerAsync(
                *BotCallbackURI*, 
                new List&lt;Modality&gt; { Modality.Audio },
                mediaConfig)
            .ConfigureAwait(false);
    });
}
</code></pre><div class="IMPORTANT"><h5>Important</h5><p>For both incoming call scenarios, the initial incoming call notification will still be received from Call Controller using the old Calling protocol, SDK automatically returns 204 No Content to the initial notification to invoke the new protocol.</p>
</div>
<h2 id="transfer">Transfer</h2>
<p>In order to do a transfer, you need to create a target object.</p>
<p>This target is the transferee in blind transfer and the original caller in consultative transfer.</p>
<pre><code> var target = new DirectoryParticipantDetails
            {
                EndpointId = *Target&#39;s Endpoint Id*,
                Id = *Target&#39;s object Id*,
            };
</code></pre><h3 id="blind-transfer">Blind transfer</h3>
<p>To make a blind transfer, only the target needs to be specified.</p>
<pre><code>await this.Client.Calls[*call id to transfer*].TransferAsync(target).ConfigureAwait(false);
</code></pre><h3 id="consultative-transfer">Consultative transfer</h3>
<pre><code>await this.Client.Calls[*call id of second call*].TransferAsync(target, *id of the original call*).ConfigureAwait(false);
</code></pre><h2 id="subscribe-to-tones">Subscribe to tones</h2>
<pre><code>await this.Client.Calls[*id of the call*].SubscribeToToneAsync().ConfigureAwait(false);
</code></pre><p>Any tones that are received are sent as part of a call update in <code>ToneInfo</code> property of the call resource.</p>
<h2 id="play-media-prompts">Play media prompts</h2>
<pre><code>await this.Client.Calls[*id of the call*].PlayPromptAsync(*A list of media prompts to play*).ConfigureAwait(false);
</code></pre><h2 id="cancel-media-processing">Cancel media processing</h2>
<p>This API will cancel all prompts that are queued to be played.</p>
<pre><code>await this.Client.Calls[*id of the call*].CancelMediaProcessingAsync().ConfigureAwait(false);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright (c) <b>Microsoft Corporation</b>. All rights reserved.
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
